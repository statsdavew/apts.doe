---
title: "APTS Design of Experiments - Assessment"
subtitle: "August 2022"
author: "Dave Woods (<D.Woods@southampton.ac.uk> ; <http://www.southampton.ac.uk/~davew>) <br> Statistical Sciences Research Institute, University of Southampton"
output: 
#beamer_presentation
pdf_document:
#  html_document:
    theme: null
    highlights: null
bibliography: ../notes/apts_doe.bib
#csl: american-statistical-association.csl
number_sections: true
---

\newcommand{\bx}{\boldsymbol{x}}
\newcommand{\btheta}{\boldsymbol{\theta}}
\newcommand{\bbeta}{\boldsymbol{\beta}}
\newcommand{\bvarepsilon}{\boldsymbol{\varepsilon}}
\newcommand{\by}{\boldsymbol{y}}
\newcommand{\rT}{\mathrm{T}}
\newcommand{\Var}{\operatorname{Var}}


<style>
pre {
  font-size: 15px;
}
</style>

```{r, echo=FALSE}
options(width=80)
library(knitr)
library(xtable)
set.seed(1)
knit_hooks$set(no.main = function(before, options, envir) {
    if (before) par(mar = c(4.1, 4.1, 1.1, 1.1), pty = "s")  # smaller margin on top
})
opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

These questions provide an opportunity to review concepts from the course and to practise the application of Design of Experiments methods in <tt>R</tt>.

The function referred to in Question 1 below is available in the <tt>apts.doe</tt> package, which can be installed from <tt>GitHub</tt>. Make sure you have the latest version of this package before attempting the assessment.

```{r github, eval = F}
library(devtools)
install_github("statsdavew/apts.doe", quiet = T)
library(apts.doe)
```

<!-- Fractional factorial design -->
1\. **Fractional factorial designs** This question is based on a real experiment performed by Tribologists at Southampton.  
Engineers in the Materials Science group at the University of Southampton wish to run an experiment to investigate the impact of contamination on material corosion in a "pin-on-disc" tribometer [(https://en.wikipedia.org/wiki/Tribometer)](https://en.wikipedia.org/wiki/Tribometer).

There are six factors that can be varied, each of which can take two values:

  - A: disc material - steel (coded -1) or silicon (+1)
  - B: pin material - steel (-1) or silicon (+1)
  - C: addition of soot - 0% by weight (-1) or 10% by weight (+1)
  - D: oxidation - 0 hours (-1) or 10 hours (+1)
  - E: addition of acid - 0mM (-1) or 25mM (+1)
  - F: moisture content - 0% (-1) or 2.5% (+1) 

The experimenters can afford $n=16$ runs. Prior knowledge from previous experiments suggests the following interactions may be important:

  - C:D
  - C:E
  - D:E
  - E:F
  
Design an appropriate fractional factorial experiment. 

The function <tt>material.response</tt> simulates data from this experiment. As input, it takes a vector of six values, each either -1 or +1, representing a single run of the experiment. Use this function to generate data for your chosen design, and perform an approriate analysis. What conclusions can you draw?

**Note**: the <tt>Effects</tt> function will not work with <tt>lm</tt> objects which are over-parameterised (ie which contain missing (<tt>NA</tt>) coefficients). You will therefore need to make sure your <tt>lm</tt> object is not over-parameterised to draw main and interaction effect plots. As the design is orthogonal (in the non-aliased effects), the easiest way to do this is to refit a linear model in just the effects of interest, eg to plot the interaction between <tt>A</tt> and <tt>B</tt>:

```{r rmna, eval = F}
materials.lmAB <- lm(y ~ A*B, data = materials.frame)
```

Of course, this doesn't break the aliasing in the design! So in this case, <tt>AB</tt> is probably aliased with another interaction (depending on the design you have chosen).

<!-- pseudo-Bayesian design using optim-->
2\. **Bayesian $D$-optimal design using <tt>optim</tt>**  
Adapt the code from the notes to find locally $D$-optimal designs with $n=2$ runs for the Poisson regression model with linear predictor $\eta(x) = \beta_0 + \beta_1 x$ with the log link (log-linear regression).

Fix $\beta_0=0$ and find designs for $\beta_1 = 1, \ldots, 6$, restricting to $-1\le x\le 1$. For each design, plot the design points along with the expected response. There is a pattern in the optimal designs, can you identify it?

The <tt>acebayes</tt> package has a function <tt>aceglm</tt> that can find Bayesian optimal designs for generalised linear models. Read the help file, and the use the function to find a Bayesian $D$-optimal design when we assume $\beta_0 = 0$ and a uniform prior distribution for $\beta_1$ with support $[1,6]$.

**Important**: when using <tt>aceglm</tt> set $N2 = 0$ (otherwise it will result in a nasty crash!).

<!-- pseudo-Bayesian design using ace -->
3\. **Bayesian $D$-optimal design using <tt>acebayes</tt>**  
In the notes, we examine a compartmental model. A simplified version of this model is given by
$$
y_i \sim N\left(\mu(x_i\,;\,\btheta), \sigma^2\right)\,, 
$$
with
$$
\mu(x_i\,;\,\btheta) = \theta_3\left[\exp\left(-\theta_1 x\right) - \exp\left(-\theta_2 x\right)\right]\,.
$$
Use the <tt>acenlm</tt> function in <tt>acebayes</tt> to find a Bayesian $D$-optimal design with $n=18$ runs, assuming $x \in [0, 24]$. Assume uniform prior distributions for $\theta_1,\theta_2$:
$$
\theta_1 \sim U(0.01884, 0.09884);\qquad \theta_2 \sim U(0.298, 8.298)
$$
with $\theta_3 = 21.8$; see @GJS2009 and @OWA2017. Plot the optimal design and realisations from the model.



## References
